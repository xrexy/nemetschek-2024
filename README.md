# Nemetschek Bulgaria RISE 2024 Homework



### Required Information

* Name: Radoslav Kolev
* Email: rkolev@proton.me
* URL: https://nemetschek.rkolev.dev/ OR https://nemetschek-2024-web.vercel.app/
* API URL: https://api.nemetscheck.rkolev.dev/ OR https://api-production-nemetschek-rkolev.up.railway.app/

## Project Structure
The project consists of two "parts":
* /api - This is the API, that contains most of the relevant implementations. (Mostly in /api/src/utils/simulation.ts)
  * Most of the simulation logic is in /api/src/utils/simulation.ts#simulationTick
  * The WebSocket handler is in /api/src/ws/handler
* /web - Not relevant for the homework, used only for visualization purposes.

## Implementation Details
* Time Factor - The ratio between program minutes and real-life milliseconds. Calculated with the formula: `(1 / MINUTES_PROGRAM) * MINUTES_REAL`
* Update Frequency / Tick Speed - Used to calculate the update interval for WebSockets. It's passed in so it depends on the time factor. Calculated with `MINUTES_FREQUENCY * timeFactorMs`
* Once a simulation is created it's appointed a slug(randomly generated by [random-word-slugs](https://www.npmjs.com/package/random-word-slugs))
* Once a simulation is created the server registers an internal Timer based on the update frequency. Each "tick" re-computes the simulation data.

## Running Locally
There are no environment variables required.

* Starting the API
```bash
cd /api
bun i # https://bun.sh/docs/installation
bun run dev

# With a specific port
PORT=8080 bun run dev
```

* Starting the web server
```bash
cd /web
pnpm i # package manager by choice
pnpm run dev
```

## WebSocket Events
WebSocket events always require you to be connected to a specific slug. All events will be associated with the selected slug.

You can connect to the WebSockets with: `ws://${URL}/ws/:slug`

* add-order - Adds an order
```json
{
  "event": "add-order",
  "payload": {
    "customerId": 1,
    "productList": {
      "bananas": 4,
      "coconut": 1,
    }
  }
}
```

* add-warehouse - Adds a warehouse
```json
{
  "event": "add-warehouse",
  "payload": {
    "name": "New Warehouse",
    "x": 100,
    "y": 50,
  }
}
```

* add-customer - Adds a customer
```json
{
  "event": "add-customer",
  "payload": {
    "id": 4,
    "name": "Radoslav Kolev",
    "coordinates": {
      "x": 50,
      "y": 40,
    }
  }
}
```

* add-product - Adds a product
```json
{
  "event": "add-product",
  "payload": {
    "name": "carrot",
    "weight": 40
  }
}
```

## WebSocket Messages
The WebSocket server always responds with the following response:
```json
{
  "ok": true,
  "message": "Success",
  "event": "add-product"
}
```
_The only exception is when the simulation data is being sent through, then it's just the simulation json._

## API Endpoints
* /api/v1/health - Checks the health of the API, used for polling on the website to see if the API is online.
```json
OK
```

* /api/v1/simulation/new - Used for creating new simulations. I don't have enough time to properly document input, but reading the templates will give you a good idea. (/web/assets/templates)
```json
{
	"status": "Created new simulation. Use /api/v1/simulation/online to see all online simulations.",
	"slug": "little-grumpy-bed"
}
```

* /api/v1/simulation/online - Returns the online simulations's "minimal" data.
```json
{
	"res": [
		{
			"analytics": {
				"openOrders": 4,
				"hasOpenOrders": true,
				"droneCount": 0,
				"totalOrdersDelivered": 2,
				"averageDistancePerDrone": 0,
				"averageDistancePerOrder": 0,
				"totalDistanceCovered": 0
			},
			"warehouses": [
				...
			],
			"drones": [],
			"timeFactorMs": 60,
			"customers": [
				...
			],
			"slug": "little-grumpy-bed"
		}
	]
}
```

* /api/v1/ws/:slug - WS is structured like a pub-sub, so slugs are like channels. When you "subscribe" you will only send and receive data for that slug. There is no "global" channel. See WebSocket Events to learn more. 

## Web Notes
This doesn't involve the homework, since all the homework solutions are in the api. Web is used only for visualizing the data.

* Web implementation uses Nuxt 3.10 and Vite 5
* Notable libraries used are: [shadcn-vue](https://www.shadcn-vue.com), [FormKit](https://formkit.com) and my beloved (TailwindCSS)[https://tailwindcss.com]
* Some remotely relevant places for the homework would be:
  * /web/pages/create/simulation.vue
  * /web/pages/simulation/[slug].vue
  * /web/assets/templates
  * /web/components/simulation

## Notes
* I've had a lot of personal issues this week, and everything here has been done in basically the last 2 days(for around 30 hours total) and is a hot mess.
* Here are some stuff I didn't get to implement(or are partially implemented in my opinion):
  * Charging Stations
  * There were sometimes "tick misses"(when tick speed goes out of sync) and I'm pretty sure they are fixed, didn't have enough time to test. From my testing, it happens sometimes but it's milliseconds and corrects itself in the next tick.
* As I mentioned I had very little time, so most routes/events don't have proper validation
